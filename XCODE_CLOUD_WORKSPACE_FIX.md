# Xcode Cloud Workspace Path Fix

## Problem

Xcode Cloud error: **"Workspace App.xcworkspace does not exist at ios/App/App.xcworkspace"**

## Root Cause

The workspace file (`App.xcworkspace`) is **not committed to git** (it's in `.gitignore` because it's generated by CocoaPods). Xcode Cloud needs the workspace to exist before it can resolve packages, but it doesn't exist in the cloned repository.

The `ci_post_clone.sh` script should create the workspace by running `pod install`, but there might be timing issues or the script might not be running correctly.

## Solution

### Step 1: Verify Xcode Cloud Workflow Configuration

1. **Open Xcode:**
   ```bash
   open ios/App/App.xcworkspace
   ```

2. **Navigate to Xcode Cloud:**
   - Go to **Product** → **Xcode Cloud** → **View Workflows**
   - Or click on your project in the navigator, then select the **Cloud** tab

3. **Edit your workflow:**
   - Select your workflow
   - Click **Edit** or the workflow settings

4. **Verify the workspace path:**
   - Find the **"Build Configuration"** section
   - Ensure **"Workspace"** is set to: `ios/App/App.xcworkspace`
   - **Important**: This is relative to the repository root

5. **Verify CI Scripts are configured:**
   - Check that **"Post-Clone Script"** is enabled
   - Script should be at: `ci_scripts/ci_post_clone.sh`
   - Script must be executable

### Step 2: Verify Post-Clone Script

The `ci_post_clone.sh` script should:
1. Install Node.js dependencies
2. Install CocoaPods
3. Run `pod install` in `ios/App/` directory
4. Create the workspace at `ios/App/App.xcworkspace`

**Check the script exists and is executable:**
```bash
ls -la ci_scripts/ci_post_clone.sh
# Should show executable permissions: -rwxr-xr-x
```

**If not executable, fix it:**
```bash
chmod +x ci_scripts/ci_post_clone.sh
git add ci_scripts/ci_post_clone.sh
git commit -m "Make ci_post_clone.sh executable"
git push
```

### Step 3: Check Build Logs

1. **In Xcode Cloud dashboard:**
   - Go to your failed build
   - Click **"View Logs"**
   - Look for the **"Post-Clone"** section

2. **Check for errors:**
   - Look for "✅ Workspace created successfully!"
   - Check for any pod install errors
   - Verify the workspace path is correct

3. **Common issues:**
   - `pod install` fails → Check CocoaPods installation
   - Workspace created but in wrong location → Check script paths
   - Script doesn't run → Check script location and permissions

### Step 4: Alternative Solution - Commit Workspace (Not Recommended)

**⚠️ Warning:** This is generally not recommended, but if the post-clone script continues to fail, you can commit the workspace:

1. **Remove from .gitignore temporarily:**
   ```bash
   # Edit .gitignore and comment out or remove:
   # *.xcworkspace/
   ```

2. **Add workspace to git:**
   ```bash
   git add -f ios/App/App.xcworkspace/
   git commit -m "Add workspace for Xcode Cloud"
   git push
   ```

3. **⚠️ Note:** This will cause merge conflicts if team members have different CocoaPods versions. Only use as a last resort.

## Verification

After fixing, verify:

1. **Check build logs:**
   - Post-Clone script should show: "✅ Workspace created successfully!"
   - No workspace errors in package resolution

2. **Verify workspace path:**
   - Xcode Cloud should find workspace at: `ios/App/App.xcworkspace`
   - Build should proceed past package resolution

## Current Configuration

- **Repository Root**: `/` (root of the repo)
- **Workspace Location**: `ios/App/App.xcworkspace` (relative to repo root)
- **CI Scripts Location**: `ci_scripts/` (at repo root)
- **Podfile Location**: `ios/App/Podfile`
- **Workspace in .gitignore**: ✅ Yes (generated by CocoaPods)

## Troubleshooting

### Issue: "Post-Clone script not found"
- **Solution**: Ensure script is at `ci_scripts/ci_post_clone.sh` (repository root)
- **Check**: Script must be executable (`chmod +x`)

### Issue: "pod install fails"
- **Solution**: Check CocoaPods is installed in the script
- **Check**: Verify `Podfile` exists at `ios/App/Podfile`

### Issue: "Workspace created but Xcode Cloud can't find it"
- **Solution**: Verify workspace path in Xcode Cloud workflow settings
- **Check**: Path should be `ios/App/App.xcworkspace` (relative to repo root)

### Issue: "Script runs but workspace still not found"
- **Solution**: Check script output in build logs
- **Check**: Verify script changes to correct directory before running `pod install`

## Quick Reference

**Correct Workspace Path for Xcode Cloud:**
```
ios/App/App.xcworkspace
```

**Post-Clone Script Location:**
```
ci_scripts/ci_post_clone.sh
```

**How to verify locally:**
```bash
cd /path/to/repo
# Run the post-clone script manually
./ci_scripts/ci_post_clone.sh
# Check workspace exists
ls -la ios/App/App.xcworkspace/contents.xcworkspacedata
```

## Next Steps

1. ✅ Verify Xcode Cloud workflow configuration
2. ✅ Check Post-Clone script exists and is executable
3. ✅ Review build logs for Post-Clone script output
4. ✅ Verify workspace is created successfully
5. ✅ Trigger a new build and monitor logs

---

**Last Updated:** November 2024
**Issue:** Xcode Cloud workspace not found after post-clone script
